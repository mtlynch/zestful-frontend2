#!/usr/bin/env bash

# Exit script on first failure.
set -e

# Echo commands before executing them, by default to stderr.
set -x

# Exit on unset variable.
set -u

CONFIG_PATH="static/config.json"
PUBLIC_CONFIG_PATH="public/config.json"
readonly CONFIG_PATH
readonly PUBLIC_CONFIG_PATH

if [[ -z "${BACKEND_URL:-}" ]]; then
  echo "BACKEND_URL must be set"
  exit 1
fi

if [[ ! -d "public" ]]; then
  echo "public directory is missing"
  exit 1
fi

cat > static/config.json <<CONFIG
{
  "BACKEND_URL": "${BACKEND_URL}"
}
CONFIG

cp "${CONFIG_PATH}" "${PUBLIC_CONFIG_PATH}"
